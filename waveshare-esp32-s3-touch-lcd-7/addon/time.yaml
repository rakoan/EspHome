time:
  - platform: homeassistant
    id: homeassistant_time
    on_time_sync:
      - script.execute: time_update
    on_time:
      - seconds: 0
        then:
          - script.execute: time_update
    
      # Turn off the screen at 2 at night. The package makes sure to run the antiburn when the
      # screen is off automatically, but you do need to remember to turn the screen off.
      - seconds: 0
        minutes: 0
        hours: 22
        then:
          - script.execute: display_off
      - seconds: 0
        minutes: 0
        hours: 5
        then:
          - script.execute: display_on

script:
  - id: time_update
    then:
      - lvgl.label.update:
          id: display_time
          #text:
            #time_format: "%H:%M"
          text: !lambda |-
            static char time_buf[17];
            auto now = id(homeassistant_time).now();
            snprintf(time_buf, sizeof(time_buf), "%02d:%02d", now.hour, now.minute);
            return time_buf;
  - id: display_off
   then:
     - switch.turn_off: backlight
     - lvgl.pause:
         show_snow:true
  - id: display_on
   then:
     - lvgl.resume:
     - lvgl.widget.redraw
     #- delay: 10ms
     - switch.turn_on: backlight
